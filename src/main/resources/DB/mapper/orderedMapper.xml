<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.food.project.ordered.OrderedDAO">

	<select id="orderedCount" resultType="Long">
		select ordered_seq.nextval from dual
	</select>

	<select id="orderedList" parameterType="OrderedVO" resultType="OrderedVO">
		SELECT * FROM ordered WHERE memberNum=#{memberNum} AND isOrderChecked=#{isOrderChecked} AND deleteAt IS NULL
	</select>
	
	<select id="orderedListNot" parameterType="OrderedVO" resultType="OrderedVO">
		SELECT * FROM ordered where memberNum=#{memberNum} AND isOrderChecked!=#{isOrderChecked} AND deleteAt IS NULL
	</select>
	
	<select id="orderedSelect" parameterType="OrderedVO" resultType="OrderedVO">
		SELECT * FROM ordered WHERE num=#{num}
	</select>
	
	<!-- isOrderChecked 다음에 isReview 필드 추가(Default = 0) -->
	<insert id="orderedInsert" parameterType="OrderedVO">
		INSERT INTO ordered VALUES(
			#{num}, #{memberNum}, #{marketNum},#{menuNum},#{marketName},#{menuName},#{menuThumbImg}, #{cateMenuOptions, jdbcType=VARCHAR}, 
			#{pcs}, #{amount}, #{imp_uid, jdbcType=VARCHAR}, #{merchant_uid, jdbcType=VARCHAR}, #{pg, jdbcType=VARCHAR}, 
			#{pay_method, jdbcType=VARCHAR}, #{apply_num, jdbcType=VARCHAR}, #{cancleType, jdbcType=INTEGER}, 
			#{cancleDetail, jdbcType=VARCHAR}, #{isOrderChecked}, #{isReview}, #{timeLag}, sysdate, sysdate, null
		)
	</insert>
	
	<!-- 마켓에서 주문 확인 -->
	<update id="orderedConfirm" parameterType="OrderedVO">
		UPDATE ordered SET isOrderChecked=2, updateAt=sysdate WHERE num=#{num} AND deleteAt IS NOT NULL
	</update>
	
	<!-- 결제 완료 없데이트 -->
	<update id="orderedDone" parameterType="OrderedVO">
		UPDATE ordered SET 
		imp_uid=#{imp_uid, jdbcType=VARCHAR}, merchant_uid=#{merchant_uid, jdbcType=VARCHAR}, 
		pg=#{pg, jdbcType=VARCHAR}, pay_method=#{pay_method}, apply_num=#{apply_num, jdbcType=VARCHAR}, 
		isOrderChecked=1, updateAt=sysdate WHERE num=#{num}
	</update>
	
	<!-- isReview 없데이트 -->
	<update id="orderedIsReviewUpdate" parameterType="OrderedVO">
		UPDATE ordered SET isReview = 1 WHERE num=#{num}
	</update>
	
	<!-- 결제 후, 지우기(UPDATE deleteAt) -->
	<update id="orderedCancle" parameterType="OrderedVO">
		UPDATE ordered SET cancleType=#{cancleType}, cancleDetail=#{cancleDetail, jdbcType=VARCHAR}, deleteAt=sysdate WHERE num=#{num}
	</update>
	
	<delete id="cartDeleteAll" parameterType="OrderedVO">
		delete from ordered where memberNum=#{memberNum}
	</delete>
	
	<!-- 장바구니에서 지우기(DELETE) -->
	<delete id="orderDelete" parameterType="OrderedVO">
		DELETE FROM ordered WHERE num = #{num}
	</delete>
	
</mapper>